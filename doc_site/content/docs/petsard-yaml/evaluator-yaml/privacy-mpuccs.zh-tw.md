---
title: "mpUCCs 隱私風險評估（實驗性功能）"
weight: 147
---

{{< callout type="warning" >}}
**實驗性功能**：mpUCCs 是一個仍在開發中的實驗性隱私風險評估方法。API 和行為可能在未來版本中改變。
{{< /callout >}}

使用最大部分唯一欄位組合（Maximal Partial Unique Column Combinations, mpUCCs）評估隱私風險，這是一種進階的單挑風險評估演算法，能識別可唯一識別記錄的欄位組合。

## 概述

mpUCCs（最大部分唯一欄位組合）實作了基於以下理論的進階隱私風險評估：
- **理論基礎**：mpUCCs = QIDs（準識別符）
- **核心概念**：單挑攻擊尋找合成資料中的唯一欄位組合，這些組合對應到原始資料中的唯一記錄
- **優勢**：透過只關注最大組合來避免過度估計

### 主要特點
1. 基於熵值修剪的漸進式樹狀搜尋
2. 自動處理數值和日期時間欄位的精度
3. 使用欄位衰減因子的加權風險計算
4. 完善的進度追蹤

## 資料前處理細節

MPUCCs 執行多個前處理步驟以確保準確的隱私風險評估：

### 缺失值處理
- **NA 比較**：比較值時，`pd.NA`（pandas 缺失值）會被單獨處理
- **安全比較**：使用 `fillna(False)` 將 NA 比較結果轉換為布林遮罩中的 False
- **備援邏輯**：對於邊緣情況，透過明確的 NA 檢查來迭代處理值

### 精度處理

#### 數值精度
- **自動偵測**：自動偵測浮點數的小數位數
- **四捨五入**：使用 `round()` 對指定的小數位數進行一致的四捨五入
- **整數保留**：整數欄位保持不變

#### 日期時間精度
- **自動偵測**：偵測最小時間精度（日、小時、分鐘、秒、毫秒、微秒、奈秒）
- **向下取整**：使用 `dt.floor()` 向下取整到指定精度
- **不區分大小寫**：支援各種精度格式輸入（例如：'D'、'd'、'H'、'h'）

### 去重複化
- **完全重複**：分析前移除完全重複的資料列
- **索引重設**：去重複後重設 DataFrame 索引
- **記錄日誌**：報告移除的重複資料數量

### 欄位處理順序
- **基於基數**：按唯一值數量（降序）排序欄位
- **高基數優先**：優先處理具有較多唯一值的欄位
- **效率考量**：此順序通常能更快識別並達到更好的剪枝效果

## 使用範例

```yaml
Evaluator:
  mpuccs_assessment:
    method: mpuccs
    n_cols:        # 要評估的組合大小（預設：null = 從 1 到總欄位數的所有大小）
      - 1
      - 2
    min_entropy_delta: 0.01     # 最小熵增益閾值（預設：0.0）
    field_decay_factor: 0.5     # 欄位組合加權衰減（預設：0.5）
    renyi_alpha: 2.0            # Rényi 熵參數（預設：2.0）
    numeric_precision: null     # 自動偵測或指定小數位數（預設：null）
    datetime_precision: null    # 自動偵測或指定時間精度（預設：null）
```

## 參數說明

| 參數 | 類型 | 必要性 | 預設值 | 說明 |
|-----|------|--------|--------|------|
| **method** | `string` | 必要 | - | 固定值：`mpuccs` |
| **n_cols** | `int`、`list`、`null` | 選用 | null | 要評估的目標組合大小<br>- `null`（預設）：從 1 到總欄位數的所有可能大小<br>- `int`：單一特定大小<br>- `list`：多個特定大小 |
| **min_entropy_delta** | `float` | 選用 | 0.0 | 修剪用的最小熵增益閾值<br>較高值 = 更積極的修剪 |
| **field_decay_factor** | `float` | 選用 | 0.5 | 欄位組合加權的衰減因子<br>降低較大組合的權重 |
| **renyi_alpha** | `float` | 選用 | 2.0 | Rényi 熵計算的 alpha 參數<br>- α=0：Hartley 熵（最大熵）<br>- α=1：Shannon 熵<br>- α=2：碰撞熵（預設）<br>- α→∞：最小熵<br>較高的 α 值會給予頻繁值更多權重 |
| **numeric_precision** | `int`、`null` | 選用 | null | 數值欄位比較的精度<br>- `null`：自動偵測<br>- `int`：小數位數 |
| **datetime_precision** | `string`、`null` | 選用 | null | 日期時間欄位比較的精度<br>- `null`：自動偵測<br>- 選項：'D'、'H'、'T'、's'、'ms'、'us'、'ns' |

### 日期時間精度選項
- `D`：天
- `H`：小時
- `T`：分鐘
- `s`：秒
- `ms`：毫秒
- `us`：微秒
- `ns`：奈秒

## 評估結果

mpUCCs 回傳三種類型的結果：

### 1. 全域統計（`global`）
整體隱私風險指標包括：
- `total_syn_records`：合成記錄總數
- `total_ori_records`：原始記錄總數
- `total_identified`：被識別的記錄數
- `identification_rate`：識別率
- `weighted_identification_rate`：加權識別率
- `total_combinations_checked`：評估的組合數
- `total_combinations_pruned`：修剪的組合數

### 2. 詳細結果（`details`）
每個被識別記錄的具體碰撞資訊：
- `combo_size`：識別組合的大小
- `syn_idx`：在合成資料中的索引
- `field_combo`：使用的欄位組合
- `value_combo`：造成識別的實際值
- `ori_idx`：在原始資料中的對應索引

### 3. 樹狀搜尋結果（`tree`）
完整的搜尋樹顯示：
- `check_order`：評估順序
- `combo_size`：組合大小
- `field_combo`：欄位組合
- `combo_entropy`：組合的熵值
- `entropy_gain`：相對於基礎的熵改善
- `is_pruned`：組合是否被修剪
- `mpuccs_cnt`：合成資料中的唯一組合數
- `mpuccs_collision_cnt`：發現的碰撞數
- `weighted_mpuccs_collision_cnt`：加權碰撞數

## 演算法細節

### 漸進式欄位搜尋
1. 欄位按基數降序處理
2. 對每個欄位，漸進式建立組合
3. 基於熵的修剪消除無效組合
4. 只保留最大組合

### 熵計算
使用 Rényi 熵（α=2，碰撞熵）：
```
H₂(X) = -log₂(∑ pᵢ²)
```
標準化到 [0, 1] 範圍以便比較

### 加權方案
- 單一欄位：權重 = 1.0
- 多個欄位：權重 = decay_factor^(size-1)
- 懲罰較大的組合以避免過度估計

## 最佳實踐

1. **從小組合開始**：從 `n_cols: [1, 2, 3]` 開始評估基本風險
2. **調整熵閾值**：增加 `min_entropy_delta` 以獲得更快的評估和更多修剪
3. **精度設定**：除非有特定需求，否則讓自動偵測處理精度
4. **解釋結果**：關注 `weighted_identification_rate` 進行整體風險評估

## 與傳統方法的比較

| 層面 | mpUCCs | 傳統單挑風險 |
|------|--------|--------------|
| **組合選擇** | 僅最大組合 | 所有組合 |
| **風險估計** | 更準確 | 可能過度估計 |
| **效能** | 使用修剪優化 | 窮舉搜尋 |
| **加權** | 欄位衰減因子 | 通常均勻 |
| **精度處理** | 內建 | 手動預處理 |

## 注意事項

{{< callout type="info" >}}
**效能考量**
- 具有許多欄位的大型資料集可能需要大量計算時間
- 使用 `n_cols` 參數限制組合大小
- 增加 `min_entropy_delta` 以進行更積極的修剪
{{< /callout >}}

{{< callout type="warning" >}}
**解釋指引**
- 分數 0.0 不代表零風險
- 結合其他隱私指標一起考慮結果
- 考慮「先收集、後解密」（HNDL）風險
{{< /callout >}}