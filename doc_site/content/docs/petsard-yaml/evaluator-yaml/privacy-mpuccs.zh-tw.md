---
title: "mpUCCs 隱私風險評估（實驗性功能）"
weight: 147
---

{{< callout type="warning" >}}
**實驗性功能**：mpUCCs 是一個仍在開發中的實驗性隱私風險評估方法。API 和行為可能在未來版本中改變。
{{< /callout >}}

使用最大部分唯一欄位組合（Maximal Partial Unique Column Combinations, mpUCCs）評估隱私風險，這是一種進階的單挑風險評估演算法，能識別可唯一識別記錄的欄位組合。

## 概述

mpUCCs（最大部分唯一欄位組合）實作了基於以下理論的進階隱私風險評估：
- **理論基礎**：mpUCCs = QIDs（準識別符）
- **核心概念**：單挑攻擊尋找合成資料中的唯一欄位組合，這些組合對應到原始資料中的唯一記錄
- **優勢**：透過只關注最大組合來避免過度估計
- **框架**：實作基於 SAFE 框架的三層保護指標

### 主要特點
1. 基於熵值修剪的漸進式樹狀搜尋
2. 自動處理數值和日期時間欄位的精度
3. 使用欄位衰減因子的加權風險計算
4. 完善的進度追蹤
5. **三層保護指標**：
   - 主要保護：直接對抗識別的保護
   - 基線保護：基於屬性分佈的理論保護
   - 整體保護：標準化保護分數（0-1）

## 資料前處理細節

MPUCCs 執行多個前處理步驟以確保準確的隱私風險評估：

### 缺失值處理
- **NA 比較**：比較值時，`pd.NA`（pandas 缺失值）會被單獨處理
- **安全比較**：使用 `fillna(False)` 將 NA 比較結果轉換為布林遮罩中的 False
- **備援邏輯**：對於邊緣情況，透過明確的 NA 檢查來迭代處理值

### 精度處理

#### 數值精度
- **自動偵測**：自動偵測浮點數的小數位數
- **四捨五入**：使用 `round()` 對指定的小數位數進行一致的四捨五入
- **整數保留**：整數欄位保持不變

#### 日期時間精度
- **自動偵測**：偵測最小時間精度（日、小時、分鐘、秒、毫秒、微秒、奈秒）
- **向下取整**：使用 `dt.floor()` 向下取整到指定精度
- **不區分大小寫**：支援各種精度格式輸入（例如：'D'、'd'、'H'、'h'）

### 去重複化
- **完全重複**：分析前移除完全重複的資料列
- **索引重設**：去重複後重設 DataFrame 索引
- **記錄日誌**：報告移除的重複資料數量

### 欄位處理順序
- **基於基數**：按唯一值數量（降序）排序欄位
- **高基數優先**：優先處理具有較多唯一值的欄位
- **效率考量**：此順序通常能更快識別並達到更好的剪枝效果

## 使用範例

```yaml
Evaluator:
  mpuccs_assessment:
    method: mpuccs
    max_baseline_cols: null     # 要評估的最大欄位數（預設：null = 所有欄位）
    min_entropy_delta: 0.01     # 最小熵增益閾值（預設：0.0）
    field_decay_factor: 0.5     # 欄位組合加權衰減（預設：0.5）
    renyi_alpha: 2.0            # Rényi 熵參數（預設：2.0）
    numeric_precision: null     # 自動偵測或指定小數位數（預設：null）
    datetime_precision: null    # 自動偵測或指定時間精度（預設：null）
    calculate_baseline: true    # 計算基線保護指標（預設：true）
```

## 參數說明

| 參數 | 類型 | 必要性 | 預設值 | 說明 |
|-----|------|--------|--------|------|
| **method** | `string` | 必要 | - | 固定值：`mpuccs` |
| **max_baseline_cols** | `int`、`null` | 選用 | null | 要評估和計算基線的最大欄位數<br>- `null`（預設）：評估所有可能的組合（1 到總欄位數）<br>- `int`：評估從 1 到 n 欄位的組合<br>範例：5 = 只評估 1、2、3、4、5 欄位組合<br>**同時控制評估範圍和基線計算**<br>適用於限制多欄位資料集的計算量 |
| **min_entropy_delta** | `float` | 選用 | 0.0 | 修剪用的最小熵增益閾值<br>較高值 = 更積極的修剪 |
| **field_decay_factor** | `float` | 選用 | 0.5 | 欄位組合加權的衰減因子<br>降低較大組合的權重 |
| **renyi_alpha** | `float` | 選用 | 2.0 | Rényi 熵計算的 alpha 參數<br>- α=0：Hartley 熵（最大熵）<br>- α=1：Shannon 熵<br>- α=2：碰撞熵（預設）<br>- α→∞：最小熵<br>較高的 α 值會給予頻繁值更多權重 |
| **numeric_precision** | `int`、`null` | 選用 | null | 數值欄位比較的精度<br>- `null`：自動偵測<br>- `int`：小數位數 |
| **datetime_precision** | `string`、`null` | 選用 | null | 日期時間欄位比較的精度<br>- `null`：自動偵測<br>- 選項：'D'、'H'、'T'、's'、'ms'、'us'、'ns' |
| **calculate_baseline** | `boolean` | 選用 | true | 啟用基線保護指標計算<br>基於屬性值分佈 |

### 日期時間精度選項
- `D`：天
- `H`：小時
- `T`：分鐘
- `s`：秒
- `ms`：毫秒
- `us`：微秒
- `ns`：奈秒

## 評估結果

mpUCCs 回傳三種類型的結果：

### 1. 全域統計（`global`）
簡化的隱私風險指標，採用方案 B（三層保護架構）：

#### 核心指標（依重要性排序）
當 `calculate_baseline=true` 時：
1. **`privacy_risk_score`** ⭐ - 整體隱私風險（0=安全，1=危險）
   - 公式：`1 - overall_protection`
   - **決策時最重要的指標**

2. **`overall_protection`** - 標準化保護分數（0-1）
   - 公式：`min(main_protection / baseline_protection, 1.0)`
   - 比較實際保護與理論最佳值

3. **`main_protection`** - 直接對抗識別的保護
   - 公式：`1 - identification_rate`
   - 合成資料提供的原始保護

4. **`baseline_protection`** - 資料結構的理論保護
   - 基於屬性基數（cardinality）
   - 代表完全隨機資料的保護能力

5. **`identification_rate`** - 被識別記錄的比例
   - 公式：`identified_records / total_records`

6. **`total_identified`** - 被識別的記錄數
7. **`total_syn_records`** - 合成記錄總數

當 `calculate_baseline=false` 時：
- `identification_rate` - 主要風險指標
- `main_protection` - 簡單保護（1 - 識別率）
- `total_identified` - 被識別的記錄數
- `total_syn_records` - 合成記錄總數

### 2. 詳細結果（`details`）
簡化的碰撞資訊，採用風險優先排序：

#### 欄位順序（依重要性）
1. **`risk_level`** ⭐ - 風險分類（高/中/低）
   - 置於首位便於快速風險評估
2. **`syn_idx`** - 合成資料中的索引
3. **`ori_idx`** - 原始資料中的對應索引
4. **`combo_size`** - 識別組合的大小
5. **`field_combo`** - 使用的欄位組合
6. **`value_combo`** - 造成識別的實際值
7. **`baseline_protection`** - 此組合的基線保護（如果啟用）

#### 風險等級分類
- **高風險**：保護比率 < 0.3 或 combo_size ≤ 2
- **中風險**：保護比率 0.3-0.7 或 combo_size 3-4
- **低風險**：保護比率 > 0.7 或 combo_size ≥ 5

### 3. 樹狀搜尋結果（`tree`）
簡化的搜尋樹，將必要欄位置於前方：

#### 核心欄位（總是顯示）
1. **`check_order`** - 評估序號
2. **`field_combo`** - 測試的欄位組合
3. **`combo_size`** - 組合中的欄位數量
4. **`is_pruned`** - 組合是否被修剪（true/false）
5. **`mpuccs_cnt`** - 在合成資料中發現的唯一組合
6. **`mpuccs_collision_cnt`** - 成功識別的記錄數

#### 保護指標（如果啟用基線）
7. **`baseline_protection`** - 此組合的理論保護
8. **`overall_protection`** - 標準化保護分數（如果有碰撞）

#### 技術細節（僅在非預設設定時顯示）
這些欄位只在使用非預設熵值或衰減設定時出現：
- **`entropy`** - 組合熵值
- **`entropy_gain`** - 相對於基礎組合的熵改善
- **`field_weight`** - 此組合的權重因子
- **`weighted_collision`** - 加權碰撞數

{{< callout type="info" >}}
**簡化輸出**：樹狀結果現在優先顯示必要資訊。使用預設設定時隱藏技術細節以減少混亂。
{{< /callout >}}

## 演算法細節

### 漸進式欄位搜尋
1. 欄位按基數降序處理
2. 對每個欄位，漸進式建立組合
3. 基於熵的修剪消除無效組合
4. 只保留最大組合

### 熵計算
使用 Rényi 熵（α=2，碰撞熵）：
```
H₂(X) = -log₂(∑ pᵢ²)
```
標準化到 [0, 1] 範圍以便比較

### 加權方案
- 單一欄位：權重 = 1.0
- 多個欄位：權重 = decay_factor^(size-1)
- 懲罰較大的組合以避免過度估計

## 最佳實踐

1. **從小組合開始**：從 `n_cols: [1, 2, 3]` 開始評估基本風險
2. **調整熵閾值**：增加 `min_entropy_delta` 以獲得更快的評估和更多修剪
3. **精度設定**：除非有特定需求，否則讓自動偵測處理精度
4. **解釋結果**：
   - 使用 `overall_protection` 進行標準化風險評估（0-1 範圍）
   - 比較 `main_protection` 與 `baseline_protection` 以了解風險來源
   - 關注 `privacy_risk_score` 用於主管報告

## 與傳統方法的比較

| 層面 | mpUCCs | 傳統單挑風險 |
|------|--------|--------------|
| **組合選擇** | 僅最大組合 | 所有組合 |
| **風險估計** | 更準確 | 可能過度估計 |
| **效能** | 使用修剪優化 | 窮舉搜尋 |
| **加權** | 欄位衰減因子 | 通常均勻 |
| **精度處理** | 內建 | 手動預處理 |
| **基線比較** | 三層保護 | 簡單識別率 |
| **風險標準化** | 0-1 範圍含基線 | 原始百分比 |

## 注意事項

{{< callout type="info" >}}
**效能考量**
- 具有許多欄位的大型資料集可能需要大量計算時間
- 使用 `n_cols` 參數限制組合大小
- 增加 `min_entropy_delta` 以進行更積極的修剪
{{< /callout >}}

{{< callout type="warning" >}}
**解釋指引**
- 分數 0.0 不代表零風險
- 結合其他隱私指標一起考慮結果
- 考慮「先收集、後解密」（HNDL）風險
{{< /callout >}}

## 風險閾值建議 🎯

### 執行摘要
對於大多數使用案例，我們建議目標為 **privacy_risk_score < 0.1**（相當於 overall_protection > 0.9）。

### 依使用案例的詳細風險閾值

| 使用案例 | 隱私風險分數 | 整體保護 | 建議 |
|---------|-------------|---------|------|
| **公開發布** | < 0.05 | > 0.95 | 風險極低，適合公開資料集 |
| **研究分享** | < 0.10 | > 0.90 | 低風險，適合研究合作 |
| **內部分析** | < 0.20 | > 0.80 | 可接受的內部使用（需存取控制） |
| **開發/測試** | < 0.30 | > 0.70 | 適合使用合成資料進行開發 |
| **高風險資料** | < 0.01 | > 0.99 | 醫療/金融資料需要最大保護 |

### 其他指標指引

#### 識別率閾值
- **優秀**：< 1% 記錄被識別
- **良好**：1-5% 記錄被識別
- **可接受**：5-10% 記錄被識別
- **不佳**：> 10% 記錄被識別

#### 基線保護考量
- 若 `baseline_protection > 0.95`：資料結構本身提供良好保護
- 若 `baseline_protection < 0.90`：考慮加入雜訊或概化屬性
- 若 `baseline_protection < 0.80`：高風險資料結構，需要顯著保護措施

### 依風險等級的緩解策略

{{< callout type="info" >}}
**高風險（privacy_risk_score > 0.3）**
- 加入差分隱私雜訊
- 概化或抑制高風險屬性
- 增加 k-匿名性參數
- 考慮使用完全合成資料
{{< /callout >}}

{{< callout type="warning" >}}
**中風險（0.1 < privacy_risk_score ≤ 0.3）**
- 檢視並概化準識別符
- 對稀有值進行針對性抑制
- 實施存取控制
- 監控使用模式
{{< /callout >}}

{{< callout type="success" >}}
**低風險（privacy_risk_score ≤ 0.1）**
- 適用標準發布程序
- 記錄所採取的隱私措施
- 建議定期重新評估
- 適合大多數使用案例
{{< /callout >}}

### 持續監控建議
1. **季度審查**：每 3 個月重新評估隱私指標
2. **資料漂移監控**：檢查資料分佈是否顯著改變
3. **攻擊演進**：根據新攻擊技術更新閾值
4. **法規更新**：根據新隱私法規調整閾值

## 理解簡化後的指標

### 為什麼隱私風險分數放在最前面？
**privacy_risk_score** 放在第一位，因為它是決策時最重要的單一指標：
- **0.0 - 0.1**：風險極低，可安全發布
- **0.1 - 0.3**：風險可接受，適合內部使用
- **0.3 - 0.5**：中等風險，需額外保護措施
- **0.5 - 1.0**：高風險，不建議發布

### 三層保護模型解釋

1. **隱私風險分數**（最高層 - 決策指標）
   - 主管需要知道的關鍵數字
   - 單一數值用於風險評估
   - 公式：`1 - 整體保護`

2. **整體保護**（標準化比較）
   - 比較合成資料品質與理論最佳值
   - 考慮資料結構的限制
   - 值為 1.0 表示「與隨機資料一樣好」

3. **主要 vs 基線保護**（詳細分析）
   - **主要**：實際達到的保護
   - **基線**：給定資料結構下的最大可能保護
   - 比率顯示合成品質

### 解讀範例
```
privacy_risk_score: 0.15     # 低風險（很好！）
overall_protection: 0.85      # 達到理論最大值的 85%
main_protection: 0.90         # 90% 記錄受保護
baseline_protection: 0.95     # 隨機資料可達 95% 保護
identification_rate: 0.10     # 10% 記錄被識別
total_identified: 100         # 100 筆記錄有風險
total_syn_records: 1000       # 總共 1000 筆
```
**結論**：合成資料表現良好（達到理論最佳的 85%），風險等級可接受（0.15）。