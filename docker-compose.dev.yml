version: '3.8'

services:
  petsard-dev:
    build:
      context: .
      dockerfile: Dockerfile.dev
    image: petsard-dev:latest
    container_name: petsard-dev
    ports:
      - "8888:8888"  # Jupyter Lab
    volumes:
      # Mount source code for live development
      - ./petsard:/app/petsard
      - ./demo:/app/demo
      - ./templates:/app/templates
      - ./notebooks:/app/notebooks  # Persistent notebooks
      - ./data:/app/data            # Data directory
      - ./output:/app/output        # Output directory
      # Mount configuration files
      - ./pyproject.toml:/app/pyproject.toml
      - ./README.md:/app/README.md
    environment:
      - PYTHONPATH=/app
      - JUPYTER_ENABLE_LAB=yes
      - JUPYTER_TOKEN=
      - JUPYTER_ALLOW_ROOT=1
      - PYTHONUNBUFFERED=1
      - PYTHONDONTWRITEBYTECODE=1
      - PETSARD_ENV=development
    working_dir: /app
    command: >
      bash -c "
        echo '🚀 Starting PETsARD Development Environment...' &&
        echo '🔬 Jupyter Lab starting at http://localhost:8888' &&
        echo '📁 Notebooks directory: /app/notebooks' &&
        echo '📂 Data directory: /app/data' &&
        echo '📤 Output directory: /app/output' &&
        echo '⚡ Live code reloading enabled' &&
        jupyter lab --ip=0.0.0.0 --port=8888 --no-browser --allow-root --NotebookApp.token='' --NotebookApp.password=''
      "
    restart: unless-stopped

  # Optional: Add a service for running tests
  petsard-test:
    build:
      context: .
      dockerfile: Dockerfile.dev
    image: petsard-dev:latest
    container_name: petsard-test
    volumes:
      - ./petsard:/app/petsard
      - ./tests:/app/tests
      - ./pyproject.toml:/app/pyproject.toml
    environment:
      - PYTHONPATH=/app
      - PETSARD_ENV=testing
    working_dir: /app
    command: pytest -v
    profiles: ["testing"]

networks:
  default:
    name: petsard-dev-network